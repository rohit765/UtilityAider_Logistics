function soundex(a){if(a=(a+"").toUpperCase(),!a)return"";for(var b,c,d,e=[0,0,0,0],f={B:1,F:1,P:1,V:1,C:2,G:2,J:2,K:2,Q:2,S:2,X:2,Z:2,D:3,T:3,L:4,M:5,N:5,R:6},g=0,h=0;(c=a.charAt(g++))&&4>h;)(b=f[c])?b!==d&&(e[h++]=d=b):(h+=1===g,d=0);return e[0]=a.charAt(0),e.join("")}RB=RB||{},RB.Calendar=function(a,b,c){var d=this;b=b||{},b.months=b.months||[0,1],b.now=b.now||new Date,b.startDate=b.startDate||b.now,b.selectedDate=b.selectedDate||b.startDate,b.endDate=b.endDate||new Date(b.startDate).addYears(100),b.calenderPosition=b.calenderPosition||"left",c=c||function(){};var e,f=!1,g=function(a){d.setDate(a),d.hide(),c(a)},h=["Jan","Feb","Mar","Apr","May","Jun","July","Aug","Sept","Oct","Nov","Dec"],i=["Mo","Tu","We","Th","Fr","Sa","Su"],j=b.selectedDate.toDateOnly();j.setDate(1);var k=function(){n(),$("html").click(function(b){$(b.target).is(a)||d.hide()})},l=function(){f=!1,$(a).unbind("click"),$(a).unbind("focus"),$(a).unbind("blur"),$(a).is("input[type=text]")?($(a).focus(function(a){e.is(":hidden")&&d.show(),a.stopPropagation()}),$(a).blur(function(){f||d.hide()})):$(a).click(function(a){$(".Calendar").hide(),d.show(),a.stopPropagation()}),e.mousedown(function(){f=!0}),e.mouseup(function(){f=!1}),e.click(function(a){a.stopPropagation()})};this.setStartDate=function(a){b.startDate=a,b.selectedDate<b.startDate&&(b.selectedDate=b.startDate)},this.setEndDate=function(a){b.endDate=a},this.setDate=function(c){b.selectedDate=c,$(a).is("input[type=text]")&&$(a).val(b.selectedDate.toRBString())};var m=function(){return j.toDateOnly()>b.startDate};this.previous=function(){j.toDateOnly()>b.startDate&&(j.addMonths(-1),n())},this.next=function(){j.toDateOnly().addMonths(h.length)<=b.endDate&&(j.addMonths(1),n())},this.show=function(){j=b.selectedDate.toDateOnly(),n(),e.show()},this.hide=function(){e.hide()};var n=function(){var c;e&&(c=e),e=$("<div>").addClass("Calendar").attr("id","rbcal_"+$(a).attr("id")),e.css("right"==b.calenderPosition?{position:"absolute",top:$(a).offset().top+$(a).outerHeight(!0)+2,right:$(window).width()-($(a).offset().left+$(a).outerWidth())}:{position:"absolute",top:$(a).offset().top+$(a).outerHeight(!0)+2,left:$(a).offset().left}),e.html(""),b.title&&($calendarTitle=$("<div>").addClass("CalendarTitle").text(b.title),e.append($calendarTitle));for(var d=0;d<b.months.length;d++){var f=j.toDateOnly();f.setDate(1),f.addMonths(b.months[d]);var g=o(f);0===d&&g.addClass("first"),d==b.months.length-1&&g.addClass("last"),0!==d&&d!=b.months.length-1&&g.addClass("mid"),e.append(g)}c?(e.show(),c.remove()):e.hide(),$("body").append(e),l();var h=e.children(),i=0;for(d=0,b.title&&(d=1),d;d<h.length;d++)i+=$(h[d]).outerWidth(!0);e.css("width",i)},o=function(a){var b=h[a.getMonth()],c=a.getFullYear(),e=$("<table>").addClass("monthTable");e.attr("cellpadding",0),e.attr("cellspacing","0"),e.attr("border",1);var f=$("<tbody>"),g=$("<tr>").addClass("monthHeader"),j=$("<button>").text("<");j.click(function(a){d.previous(),a.stopPropagation()});var k=$("<td>").addClass("prev").append(j);m()||j.hide();var l=$("<button>").text(">");l.click(function(a){d.next(),a.stopPropagation()});for(var n=$("<td>").addClass("next").append(l),o=$("<td>").addClass("monthTitle").attr("colspan",5).text(b+"  "+c),q=$("<tr>"),r=0;7>r;r++)q.append($("<th>").text(i[r]));g.append(k).append(o).append(n);var s=p(a);return f.append(g).append(q).append(s),e.append(f),e},p=function(a){var c=document.createDocumentFragment(),d=new Date(new Date(a).setDate(1)),e=new Date(d).addMonths(1),f=new Date(d).toDateOnly(),h=d.getDay()-1;0>h&&(h+=7);for(var i=h+(e-d)/864e5-1,j=b.startDate.toDateOnly(),k=b.endDate.toDateOnly(),l=b.selectedDate.toDateOnly(),m=b.now.toDateOnly(),n=function(a){return function(){g(a)}},o=0,p=0;6>p;p++){for(var q=$("<tr>"),r=0;7>r;r++){$day=$("<td>");var s="wd";o>=h&&i>=o?(s=6===f.getDay()||0===f.getDay()?"we":"wd",f-m===0&&(s="tdy"),(j>f||f>k)&&(s="past"),f-l===0&&(s="current"),day_content=f.getDate()):(s="empty",day_content=" "),$day.addClass(s).addClass("day").text(day_content),"past"!=s&&"empty"!=s&&$day.click(n(f.toDateOnly())),"empty"!=s&&f.addDays(1),q.append($day),o++}c.appendChild(q[0])}return c};this.get=function(){return b.selectedDate},k()},RB=RB||{},RB.AutoFill=function(a,b){var c,d=this,e=$(a);b=b||{};var f=b.dataSource||{},g=b.onSelect||function(){},h=b.filter||function(){return!0},i=function(a,c){var d=b.dataSource[a],e=b.dataSource[c];return d>e?1:e>d?-1:0},j=b.comparator||i;this.selectedId=-1;var k=[],l=!1,m=[],n=function(a){var b,c,d,e=[],g=m.length;for(d=0;g>d;d++)b=m[d],c=f[b],0===c.toUpperCase().indexOf(a.toUpperCase())&&h(b,c)&&e.push(b);if(e.length<1)for(d=0;g>d;d++)b=m[d],c=f[b],soundex(c)==soundex(a)&&h(b,c)&&e.push(b);return e.sort(j),e},o=function(){e.on("keyup",p),e.on("keydown",q),e.on("blur",s);for(var a in f)m.push(a)},p=function(a){if(13==a.which)return void t();if(38!=a.which&&40!=a.which){var b=e.val();if(""===b)return d.set(-1),void u();k=n(b),""===b&&(k=[]),x()}},q=function(a){switch(a.which){case 38:r(-1);break;case 40:r(1)}},r=function(a){var b=k.indexOf(d.selectedId);b+a>=0&&b+a<k.length&&d.set(k[b+a]);var e=$(c).find("[data-id="+d.selectedId+"]"),f=c.offset().top+c.outerHeight()-e.offset().top-e.outerHeight();c.scrollTop(c.scrollTop()-f),$(c).find("li").removeClass("selected"),$(c).find("[data-id="+d.selectedId+"]").addClass("selected")},s=function(){k.length>0&&!l&&t()},t=function(){y(d.selectedId)},u=function(){k=[],$(c).remove()},v=function(){return function(){l=!0}},w=function(a){return function(){y(a)}},x=function(){l=!1;var a=document.createElement("ul");a.className="autoFill";for(var b=!1,g=k.length,h=0;g>h;h++){var i=k[h],j=f[i],m=document.createElement("li");$(m).attr("data-id",i),$(m).click(w(i)),$(m).mousedown(v(i)),m.appendChild(document.createTextNode(j)),b||(m.className="selected",d.selectedId=i),a.appendChild(m),b=!0}$(c).remove(),b&&(c=$(a),c.css({top:e.position().top+e.outerHeight(!0)+2,left:e.position().left,width:e.outerWidth()-2}),$(c).insertAfter(e))},y=function(a){d.set(a),u(),g(a)};this.set=function(a){this.selectedId=a,e.val(f[a])},this.get=function(){return this.selectedId},o()},RB=RB||{};var Offertemplate=$("#offer_template").html();RB.RedbusOffers=new function(){var a,b,c,d=$("#txtSource"),e=$("#txtDestination"),f=$("#txtOnwardCalendar"),g=$("#txtReturnCalendar"),h=new RB.Validator($("#Search"));h.addRule("validSource",function(){return-1!=a.selectedId}),h.addRule("validDestination",function(){return-1!=b.selectedId});var i=function(){$(".offer-box").click(function(){return $(".offfer-popup").fadeIn(500),$(".offfer-popup").addClass("in"),$(".popup-overlay").fadeIn(200),$(".offer_popup_content").hide(),$("#offer"+$(this).attr("data-offer")).show(),"hotel"===$(this).attr("data-product").toLowerCase()?$("#widget_iframe").attr("src","widgets/hotel-widget.aspx?affuid=hotel-offers&branding=false"):$("#widget_iframe").attr("src","widgets/buswidget.aspx?affuid=bus-offers&branding=false"),!1}),$(".popup-overlay,.close-popup").on("click",function(){$(".offfer-popup").removeClass("in"),$(".offfer-popup").fadeOut(200),$(".popup-overlay").fadeOut(200)}),$(window).on("keydown",function(a){a=a||window.event,27===a.keyCode&&($(".popup-overlay").is("visible")||"block"===$(".popup-overlay").css("display"))&&$(".popup-overlay,.close-popup").click()})},j=function(){for(var a=$("#hf_routes").val(),b=JSON.parse(a),c=0;c<b.offerRoutes.length;c++)if((void 0!==b.offerRoutes[c].routes||null!==b.offerRoutes[c].routes)&&"*"!==b.offerRoutes[c].routes){for(var d='<h2>Routes</h2><div class="table-list"><ul>',e=0;e<b.offerRoutes[c].routes.length;e++){d+='<span><li class="list-raw-1">'+b.offerRoutes[c].routes[e].r+"</li>";var f=new Date,g="/Booking/SelectBus.aspx",h={fromCityId:b.offerRoutes[c].routes[e].s,toCityId:b.offerRoutes[c].routes[e].d,doj:f.toRBString(),busType:"Any",opId:0},i=RB.URL.create(g,h);d+='<li class="list-raw-3"><a href="'+i+'">Book Now</a></li></span>'}d+="  </ul></div>",$("#routes"+c).html(d),d=""}};this.initialize=function(){a=new RB.AutoFill(d,{dataSource:cities,onSelect:function(a){e.focus().select(),RB.Master.customerCareView.selectCity(a.split("_")[0])}}),b=new RB.AutoFill(e,{dataSource:cities,onSelect:function(){e.is(":focus")&&""===f.val()&&f.focus()},filter:function(b){return b==a.selectedId?!1:0===b.indexOf(a.selectedId+"_")?!1:!0}}),i(),j(),d.select().focus(),-1!==location.href.indexOf("#")&&(id=location.href.split("#")[1],id>=0&&id<offersCount&&($(".offfer-popup").fadeIn(500),$(".offfer-popup").addClass("in"),$(".popup-overlay").fadeIn(200),$(".offer_popup_content").hide(),$("#offer"+id).show(),"hotel"===$($("div[data-offer='"+id+"']")).attr("data-product").toLowerCase()?$("#widget_iframe").attr("src","widgets/hotel-widget.aspx?affuid=hotel-offers&branding=false"):$("#widget_iframe").attr("src","widgets/buswidget.aspx?affuid=bus-offers&branding=false")))};var k=function(){return""!==f.val()&&""!==g.val()&&Date.getFromRBDate(f.val())>Date.getFromRBDate(g.val())?($("#Search .dateError").css("visibility","visible"),!1):($("#Search .dateError").css("visibility","hidden"),!0)};this.search=function(d){d.stopPropagation();var e=h.validate();if(e&&k())if(""===f.val())c.show();else{var i="/Booking/SelectBus.aspx",j={fromCityId:a.selectedId,toCityId:b.selectedId,doj:f.val(),busType:"Any",opId:0};""!==g.val()&&(j.doj1=g.val()),location.href=RB.URL.create(i,j)}}},$(document).ready(function(){RB.RedbusOffers.initialize()});
//# sourceMappingURL=redbusoffer.min.js.map