function soundex(a){if(a=(a+"").toUpperCase(),!a)return"";for(var b,c,d,e=[0,0,0,0],f={B:1,F:1,P:1,V:1,C:2,G:2,J:2,K:2,Q:2,S:2,X:2,Z:2,D:3,T:3,L:4,M:5,N:5,R:6},g=0,h=0;(c=a.charAt(g++))&&4>h;)(b=f[c])?b!==d&&(e[h++]=d=b):(h+=1===g,d=0);return e[0]=a.charAt(0),e.join("")}RB=RB||{},RB.Calendar=function(a,b,c){var d=this;b=b||{},b.months=b.months||[0,1],b.now=b.now||new Date,b.startDate=b.startDate||b.now,b.selectedDate=b.selectedDate||b.startDate,b.endDate=b.endDate||new Date(b.startDate).addYears(100),b.calenderPosition=b.calenderPosition||"left",c=c||function(){};var e,f=!1,g=function(a){d.setDate(a),d.hide(),c(a)},h=["Jan","Feb","Mar","Apr","May","Jun","July","Aug","Sept","Oct","Nov","Dec"],i=["Mo","Tu","We","Th","Fr","Sa","Su"],j=b.selectedDate.toDateOnly();j.setDate(1);var k=function(){n(),$("html").click(function(b){$(b.target).is(a)||d.hide()})},l=function(){f=!1,$(a).unbind("click"),$(a).unbind("focus"),$(a).unbind("blur"),$(a).is("input[type=text]")?($(a).focus(function(a){e.is(":hidden")&&d.show(),a.stopPropagation()}),$(a).blur(function(){f||d.hide()})):$(a).click(function(a){$(".Calendar").hide(),d.show(),a.stopPropagation()}),e.mousedown(function(){f=!0}),e.mouseup(function(){f=!1}),e.click(function(a){a.stopPropagation()})};this.setStartDate=function(a){b.startDate=a,b.selectedDate<b.startDate&&(b.selectedDate=b.startDate)},this.setEndDate=function(a){b.endDate=a},this.setDate=function(c){b.selectedDate=c,$(a).is("input[type=text]")&&$(a).val(b.selectedDate.toRBString())};var m=function(){return j.toDateOnly()>b.startDate};this.previous=function(){j.toDateOnly()>b.startDate&&(j.addMonths(-1),n())},this.next=function(){j.toDateOnly().addMonths(h.length)<=b.endDate&&(j.addMonths(1),n())},this.show=function(){j=b.selectedDate.toDateOnly(),n(),e.show()},this.hide=function(){e.hide()};var n=function(){var c;e&&(c=e),e=$("<div>").addClass("Calendar").attr("id","rbcal_"+$(a).attr("id")),e.css("right"==b.calenderPosition?{position:"absolute",top:$(a).offset().top+$(a).outerHeight(!0)+2,right:$(window).width()-($(a).offset().left+$(a).outerWidth())}:{position:"absolute",top:$(a).offset().top+$(a).outerHeight(!0)+2,left:$(a).offset().left}),e.html(""),b.title&&($calendarTitle=$("<div>").addClass("CalendarTitle").text(b.title),e.append($calendarTitle));for(var d=0;d<b.months.length;d++){var f=j.toDateOnly();f.setDate(1),f.addMonths(b.months[d]);var g=o(f);0===d&&g.addClass("first"),d==b.months.length-1&&g.addClass("last"),0!==d&&d!=b.months.length-1&&g.addClass("mid"),e.append(g)}c?(e.show(),c.remove()):e.hide(),$("body").append(e),l();var h=e.children(),i=0;for(d=0,b.title&&(d=1),d;d<h.length;d++)i+=$(h[d]).outerWidth(!0);e.css("width",i)},o=function(a){var b=h[a.getMonth()],c=a.getFullYear(),e=$("<table>").addClass("monthTable");e.attr("cellpadding",0),e.attr("cellspacing","0"),e.attr("border",1);var f=$("<tbody>"),g=$("<tr>").addClass("monthHeader"),j=$("<button>").text("<");j.click(function(a){d.previous(),a.stopPropagation()});var k=$("<td>").addClass("prev").append(j);m()||j.hide();var l=$("<button>").text(">");l.click(function(a){d.next(),a.stopPropagation()});for(var n=$("<td>").addClass("next").append(l),o=$("<td>").addClass("monthTitle").attr("colspan",5).text(b+"  "+c),q=$("<tr>"),r=0;7>r;r++)q.append($("<th>").text(i[r]));g.append(k).append(o).append(n);var s=p(a);return f.append(g).append(q).append(s),e.append(f),e},p=function(a){var c=document.createDocumentFragment(),d=new Date(new Date(a).setDate(1)),e=new Date(d).addMonths(1),f=new Date(d).toDateOnly(),h=d.getDay()-1;0>h&&(h+=7);for(var i=h+(e-d)/864e5-1,j=b.startDate.toDateOnly(),k=b.endDate.toDateOnly(),l=b.selectedDate.toDateOnly(),m=b.now.toDateOnly(),n=function(a){return function(){g(a)}},o=0,p=0;6>p;p++){for(var q=$("<tr>"),r=0;7>r;r++){$day=$("<td>");var s="wd";o>=h&&i>=o?(s=6===f.getDay()||0===f.getDay()?"we":"wd",f-m===0&&(s="tdy"),(j>f||f>k)&&(s="past"),f-l===0&&(s="current"),day_content=f.getDate()):(s="empty",day_content=" "),$day.addClass(s).addClass("day").text(day_content),"past"!=s&&"empty"!=s&&$day.click(n(f.toDateOnly())),"empty"!=s&&f.addDays(1),q.append($day),o++}c.appendChild(q[0])}return c};this.get=function(){return b.selectedDate},k()},RB=RB||{},RB.AutoFill=function(a,b){var c,d=this,e=$(a);b=b||{};var f=b.dataSource||{},g=b.onSelect||function(){},h=b.filter||function(){return!0},i=function(a,c){var d=b.dataSource[a],e=b.dataSource[c];return d>e?1:e>d?-1:0},j=b.comparator||i;this.selectedId=-1;var k=[],l=!1,m=[],n=function(a){var b,c,d,e=[],g=m.length;for(d=0;g>d;d++)b=m[d],c=f[b],0===c.toUpperCase().indexOf(a.toUpperCase())&&h(b,c)&&e.push(b);if(e.length<1)for(d=0;g>d;d++)b=m[d],c=f[b],soundex(c)==soundex(a)&&h(b,c)&&e.push(b);return e.sort(j),e},o=function(){e.on("keyup",p),e.on("keydown",q),e.on("blur",s);for(var a in f)m.push(a)},p=function(a){if(13==a.which)return void t();if(38!=a.which&&40!=a.which){var b=e.val();if(""===b)return d.set(-1),void u();k=n(b),""===b&&(k=[]),x()}},q=function(a){switch(a.which){case 38:r(-1);break;case 40:r(1)}},r=function(a){var b=k.indexOf(d.selectedId);b+a>=0&&b+a<k.length&&d.set(k[b+a]);var e=$(c).find("[data-id="+d.selectedId+"]"),f=c.offset().top+c.outerHeight()-e.offset().top-e.outerHeight();c.scrollTop(c.scrollTop()-f),$(c).find("li").removeClass("selected"),$(c).find("[data-id="+d.selectedId+"]").addClass("selected")},s=function(){k.length>0&&!l&&t()},t=function(){y(d.selectedId)},u=function(){k=[],$(c).remove()},v=function(){return function(){l=!0}},w=function(a){return function(){y(a)}},x=function(){l=!1;var a=document.createElement("ul");a.className="autoFill";for(var b=!1,g=k.length,h=0;g>h;h++){var i=k[h],j=f[i],m=document.createElement("li");$(m).attr("data-id",i),$(m).click(w(i)),$(m).mousedown(v(i)),m.appendChild(document.createTextNode(j)),b||(m.className="selected",d.selectedId=i),a.appendChild(m),b=!0}$(c).remove(),b&&(c=$(a),c.css({top:e.position().top+e.outerHeight(!0)+2,left:e.position().left,width:e.outerWidth()-2}),$(c).insertAfter(e))},y=function(a){d.set(a),u(),g(a)};this.set=function(a){this.selectedId=a,e.val(f[a])},this.get=function(){return this.selectedId},o()},RB=RB||{},RB.Tooltip=function(a,b,c){var d=$("<div>").addClass("tooltip"),e=!1;c=c||{},c.offset=c.offset||{X:0,Y:0};var f=function(){h(),g()},g=function(){a.on("mouseover",i),a.on("mouseout",j)},h=function(){d.html(b)},i=function(a){e||(k(a),e=!0)},j=function(){l(),e=!1},k=function(a){d.hide();var b=a.currentTarget;d.css({top:m(b)+c.offset.Y,left:b.offsetLeft+b.offsetWidth+c.offset.X+10,opacity:0,display:"block"}),$("body").append(d),d.animate({opacity:1},1)},l=function(){d.animate({opacity:0},1),$(".tooltip").remove()},m=function(a){for(var b=0;null!==a;)b+=a.offsetTop,a=a.offsetParent;return b};f()};var RB=RB||{};RB.Progress=function(a,b){this.Settings.status=b.startWidth||0,this.Settings.started=b.started||!1,this.Settings.steps=b.steps-1||1,this.Settings.lastPosition=b.lastPosition||75,this.id=a,this.backgroundColor=b.backgroundColor||"#b91f1f",this.position=b.position||"fixed",this.height=b.height||"20px",this.text=b.text||"Searching for buses",this.color=b.color||"#fff"},RB.Progress.prototype.template=function(){var a=document.createElement("div");a.id="loadingbar";var b=document.createElement("span");b.id="loadingText";var c=document.createTextNode(this.text);return b.appendChild(c),a.appendChild(b),a},RB.Progress.prototype.Settings={},RB.Progress.prototype.start=function(a){if(this.timeOut&&clearInterval(this.timeOut),!this.Settings.started){this.Settings.status=50,this.Settings.initialStart=a,this.Settings.remaining=this.Settings.lastPosition-this.Settings.initialStart,this.Settings.perStepCount=parseInt(this.Settings.remaining/this.Settings.steps,10);var b=this.template();b.style.height=this.height,b.style.lineHeight=this.height,b.style.background=this.backgroundColor,document.getElementById(this.id)?(b.style.position=this.position,document.getElementById(this.id).appendChild(b)):document.getElementsByTagName("body")[0].appendChild(b),this.Settings.started=!0,this.set(a)}},RB.Progress.prototype.set=function(a){this.timeOut&&clearInterval(this.timeOut),this.Settings.started&&(100>a?(this.Settings.status=a,document.getElementById("loadingbar").style.width=a+"%",a>100||this.inc()):this.done())},RB.Progress.prototype.done=function(){var a=this;a.timeOut&&clearInterval(a.timeOut),document.getElementById("loadingbar").style.width="100%";var b=setTimeout(function(){document.getElementById("loadingbar").className+=" closed",clearTimeout(b)},1500);this.Settings.status=0,this.Settings.started=!1},RB.Progress.prototype.inc=function(){var a=parseInt(this.Settings.status,10),b=a+this.Settings.perStepCount,c=this;this.timeOut=setInterval(function(){b>a&&a<c.Settings.lastPosition&&(a+=1,c.Settings.status=parseInt(a,10),document.getElementById("loadingbar").style.width=a+"%")},50)},RB.Progress.prototype.next=function(){this.Settings.initialStart=this.Settings.initialStart+this.Settings.perStepCount,this.set(this.Settings.initialStart)},RB.Progress.setText=function(a){document.getElementById("loadingText").innerText=a};var first2availableseats=0,SeatLayout=function(a,b,c,d,e){e=e||{},e.unit=e.unit||20,e.margin=e.margin||4,e.maxSeatsAllowed=e.maxSeatsAllowed||c.mxSPrTxn||6,e.minSeatsRequired=e.minSeatsRequired||1,e.showBPMapLink=e.showBPMapLink||c.isBPMapLinkShown;var f=c.seatlist,g=c.BPInformationList,h=c.DPInformationList,i=!1;h&&h.length>0&&(i=!0);var j=[],k=null,l=null,m=$(Template.compile(a,"div")),n=function(){p(),o()},o=function(){m.find(".BPSelector .BPContainer select").change(function(){r(g[this.selectedIndex-1])}),m.find(".DPSelector .DPContainer select").change(function(){s(h[this.selectedIndex-1])}),m.find(".continueBtn").click(q)},p=function(){e.showBPSelect?e.showBPMapLink&&(m.find(".BPSelector .BPMapSelector").on("click",w),m.find(".BPSelector .BPMapSelector").show()):m.find(".BPContainer").css("visibility","hidden");var a=document.createElement("ul"),d=document.createElement("ul");$(a).addClass("deck"),$(d).addClass("deck"),m.find(".upperDeck").append(a),m.find(".lowerDeck").append(d);var g=c.maxUpperColumns*(e.unit+e.margin)-e.margin,h=c.maxLowerColumns*(e.unit+e.margin)-e.margin,i=g>h?g:h;$(a).width(i),$(d).width(i);var j=c.maxUpperRows*(e.unit+e.margin)-e.margin,k=c.maxLowerRows*(e.unit+e.margin)-e.margin,l=j>k?j:k;$(a).height(l),$(d).height(l);for(var n=[],o=0,p=0,q=0,r=0,s=0;q<f.length;q++){var t=f[q];1===t.Z&&t.IsAvailable===!0&&(0===t.X||2===t.X)&&(o=++r),0===t.Z&&t.IsAvailable===!0&&(0===t.X||1===t.X||2===t.X)&&(p=++s),f[q].IsLadies&&(t.Id+=":1");var v=x(t);0===t.Z?$(d).append(v):1==t.Z&&$(a).append(v);var y=Math.floor(t.Fare);-1==n.indexOf(y)&&0!==y&&n.push(y),$(v).addClass(0===y?"fare_z":"fare_"+(n.indexOf(y)+1))}first2availableseats=o+p,dataLayer[0].first2availableseats=first2availableseats,pricePloyHighlight=generatePricePloySelectorDOM(n,m),m.find(".leftContent").prepend(pricePloyHighlight);var z=f.filter(function(a){return!(1==a.Height&&1==a.Width)}).length>0,A=f.filter(function(a){return 1==a.Height&&1==a.Width}).length>0,B=f.filter(function(a){return 1==a.Z}).length>0;z&&!A&&12==c.maxLowerColumns&&12==c.maxUpperColumns&&3==c.maxLowerRows&&3==c.maxUpperRows&&(m.find(".upperDeck").addClass("hasCompartment"),m.find(".lowerDeck").addClass("hasCompartment")),B||(m.find(".upperDeck").hide(),m.find(".lowerDeck .label").hide()),A||(m.find(".legend").addClass("sleeper"),m.find(".legend .legendType").text("Sleeper")),u(),$(b).html(m)},q=function(){if(j.length<e.minSeatsRequired)return void alert(e.isReturn?"Please select "+e.minSeatsRequired+" "+(1===e.minSeatsRequired?"seat":"seats")+" as in the onward journey":"Please select at least "+e.minSeatsRequired+" "+(1===e.minSeatsRequired?"seat":"seats"));if(null===k&&e.showBPSelect)return void alert("Please select your boarding point");if(null===l&&e.showBPSelect&&i)return void alert("Please select your dropping point");var a={Id:c.RouteId,Name:c.Travels,Type:c.busType},b={Route:a,DOJ:Date.toDateFromJson(c.DateOfJourney),Seats:j};e.showBPSelect&&(b.BP=k,i&&(b.DP=l)),d(b)},r=function(a){"undefined"!=typeof a&&null!==a?(k=a,"undefined"!=typeof a.bpAdd&&null!==a.bpAdd&&"null"!==a.bpAdd&&""!==a.bpAdd?(m.find(".addressDisplay").text(a.bpAdd),m.find(".addressDisplay").css("visibility","visible")):m.find(".addressDisplay").css("visibility","hidden")):(m.find(".addressDisplay").css("visibility","hidden"),k=null)},s=function(a){l="undefined"!=typeof a&&null!==a?a:null},t=function(a,b){b?j.push(a):j=j.filter(function(b){return b.Id!=a.Id});for(var c=[],d=0,e=0,f=0,g=0,h=0;h<j.length;h++)c.push(j[h].Id),d+=j[h].fares.NetFare,e+=j[h].fares.Tax,f+=j[h].fares.Amount,g+=j[h].fares.ServiceCharge;var i="Rs. "+d,k="Rs. "+parseFloat(e).toFixed(2),l="Rs. "+parseFloat(f).toFixed(2),n="Rs. "+parseFloat(g).toFixed(2);0>=d&&(i="Rs. "+f),0>=f&&(l=""),m.find(".fare .seatsSelected span").text(c.join(", ")),m.find(".fare .amount .basefare").text(i),e>0?(m.find("#svtDiv").show(),m.find(".fare .amount .servicetax").text(k)):(m.find("#svtDiv").hide(),m.find(".fare .amount .servicetax").text("")),g>0?(m.find("#svcDiv").show(),m.find(".fare .amount .servicecharge").text(n)):(m.find("#svcDiv").hide(),m.find(".fare .amount .servicecharge").text("")),m.find(".fare .amount .totalfare").text(l)},u=function(){var a,b,d=document.createDocumentFragment();for(a=0;a<g.length;a++){var e=g[a],f=e.bpTime>=1440?v(Date.toDateFromJson(c.DateOfJourney)):"";b=document.createElement("option"),b.value=e.bpId,b.innerHTML=e.bpLocation+" - "+convertIntToTimeString(e.bpTime)+"&nbsp;&nbsp"+f,d.appendChild(b)}if(m.find(".BPSelector .BPContainer select").append(d),i){for(m.find(".BPSelector").addClass("withDP"),d=document.createDocumentFragment(),a=0;a<h.length;a++){var j=h[a];b=document.createElement("option"),b.value=j.bpId,b.innerHTML=j.bpLocation+" - "+convertIntToTimeString(j.bpTime),d.appendChild(b)}m.find(".BPSelector .DPContainer select").append(d)}},v=function(a){var b=new Date(a.setDate(a.getDate()+1)),c="( "+b.getDate()+" - "+getRBMonth(b)+")";return c},w=function(){var a="/booking/BPMap.aspx",b={routeId:c.RouteId,doj:Date.toDateFromJson(c.DateOfJourney).toRBString()};null!==k&&(b.bpid=k.bpId);var d=RB.URL.create(a,b),e=new RB.Modal(d,{width:950,height:500,showURL:!0});return window.closeSmartBP=function(){e.close()},window.selectBP=function(a){for(var b=null,c=0;c<g.length&&(b=g[c],b.bpId!=a);c++);null!==b&&(m.find(".BPSelector .BPContainer select").val(b.bpId),r(b)),e.close()},e.show(),RBxt_click(this,"C","2","SmartBoardingPoint","A")},x=function(a){var b=document.createElement("li"),c=document.createElement("a");b.appendChild(c);var d="Seat No: "+a.Id+" | Fare: Rs."+a.Fare;$(c).attr({href:"javascript:void(0)",title:d}),$(c).css({height:e.unit*a.Width,width:e.unit*a.Height}),$(b).css({left:(e.unit+e.margin)*a.X,top:(e.unit+e.margin)*a.Y});var f="";return f=a.IsAvailable?"available":"booked",a.IsLadies&&a.IsAvailable&&(f+=" ladies"),1==a.Height&&1==a.Width?f+=" seat":1==a.Height?f+=" sleeperV":2==a.Height&&(f+=" sleeper"),$(c).attr("class",f),$(c).click(a.IsAvailable?function(){var b=$(this).parent().attr("class").split("_")[1];if($(this).parents(".seatlayoutContainer").find(".pricehighlight .selected").hasClass("tab_0")||$(this).parents(".seatlayoutContainer").find(".pricehighlight .tab_"+b).trigger("click"),j.length<e.maxSeatsAllowed||$(this).hasClass("selected")){$(this).toggleClass("selected");var c=$(this).hasClass("selected");t(a,c)}else alert(e.isReturn?"A maximum of "+e.maxSeatsAllowed+(1===e.maxSeatsAllowed?" Seat":" Seats")+" can be selected as in the onward journey":"A maximum of "+e.maxSeatsAllowed+(1===e.maxSeatsAllowed?" Seat":" Seats")+" can be selected")}:function(){var a=$(this).parent().attr("class").split("_")[1];$(this).parents(".seatlayoutContainer").find(".pricehighlight .selected").hasClass("tab_0")||$(this).parents(".seatlayoutContainer").find(".pricehighlight .tab_"+a).trigger("click")}),b};n()},generatePricePloySelectorDOM=function(a,b){if(a.length<2)return"";var c=document.createElement("ul");$(c).addClass("pricehighlight").addClass("tab_"+(a.length+1));var d=document.createDocumentFragment(),e=document.createElement("li");$(e).attr("class","tab_0").html("All").addClass("selected"),d.appendChild(e);var f=a.slice();a.sort(function(a,b){return a>b});for(var g=0;g<a.length;g++){var h=document.createElement("li"),i=f.indexOf(a[g])+1;$(h).attr("class","tab_"+i).html("Rs."+a[g]),d.appendChild(h)}return c.appendChild(d),$(c).find("li").click(function(){$(c).find("li").removeClass("selected"),selectedTab=this.className.split("_")[1],$(this).addClass("selected");for(var a=b.find(".deck")[0],d="",e=a.className.split(" "),f=0;f<e.length;f++)e[f].split("sel").length>1&&(d=e[f]);b.find(".deck").removeClass(d),b.find(".deck").addClass("sel_"+selectedTab)}),c},Template=new function(){this.compile=function(a,b){b=b||"div";var c=document.createElement(b);return c.innerHTML=a,document.body.appendChild(c),document.body.removeChild(c),c}},prefixZero=function(a){return a=Number(a),10>a?"0"+a:""+a},convertIntToTimeString=function(a){var b=new Date;return b.setHours(0),b.setMinutes(0),b.setSeconds(0),b.setMilliseconds(0),b.addMins(a),b.toRBTimeString()},Filtertemplate=$("#FilterTemplate").html();"2"===RB.URL.getQueryParam("ver")&&(Filtertemplate=$("#FilterTemplateNew").html());var Filter=function(a,b){var c=this,d=[],e={Travels:[],BusType:[],Amenities:[],BP:[],DP:[],Rating:[]},f=JSON.parse(RB.Preferences.get("LAST_USED_FILTERS"));null===f&&(f=[]);var g,h=function(){for(i=0,routesLength=a.length;i<routesLength;i++){var b=a[i];e.Travels.contains(b.Tvs)||e.Travels.push(b.Tvs),e.Travels.sort(),e.BusType=["AC","Non AC","Sleeper"],e.Amenities=["Movie","Water Bottle","Blankets","Charging Point","Live Bus Tracking"];var c,d=b.BPLst;for(c=0,bpLength=d.length;c<bpLength;c++)e.BP.contains(d[c].Loc.trim())||e.BP.push(d[c].Loc.trim());e.BP.sort();var f=b.DPLst;for(c=0,dpLength=f.length;c<dpLength;c++)e.DP.contains(f[c].Loc.trim())||e.DP.push(f[c].Loc.trim());e.DP.sort(),e.Rating=["Higher Rated","All Buses"]}};this.render=function(){var a=Filtertemplate;return g=$("<div>").html(a).addClass("FilterBar"),g.find(".Travels").append(j("Travels")).addClass("filter"),g.find(".BusType").append(j("BusType")).addClass("filter"),g.find(".Amenities").append(j("Amenities")).addClass("Amenities"),g.find(".BP").append(j("BP")).addClass("filter"),g.find(".DP").append(j("DP")).addClass("filter"),g.find(".Rating").append(j("Rating")).addClass("Rating"),g.find(".filter a.dpBtn").on("click",n),$("html").on("click",function(){g.find(".filter").removeClass("opened")}),g.find(".filter ul").on("click",function(a){a.stopPropagation()}),g.find(".filterTipLink").on("click",function(){}),g};var j=function(a){for(var b=$("<ul>"),c=0,d=e[a].length;d>c;c++){var f=e[a][c],g={type:a,key:f},h=m(g),i=$("<input>").attr({type:"checkbox",id:h}),j=$("<label>").text(f).attr("for",h);i.on("change",p(g));var k=$("<li>").append(i).append(j);b.append(k)}if("Rating"!=a){var l=$("<a>").addClass("clear").text("Clear").attr("href","javascript:void(0);");l.on("click",function(){s(a)}),b.append($("<li>").append(l))}return b},k=function(){g.find("a").removeClass("inactive").removeClass("active");var a,c;for(a=0;a<d.length;a++)c=d[a],g.find("."+c.type+" a").addClass("active");var e=g.find(".activeFiltersList");for(e.find(".activeFilter").remove(),a=0;a<d.length;a++)c=d[a],e.append(l(c));d.length>0?e.show():e.hide(),b()},l=function(a){var b=$("<a>").attr("href","javascript:void(0);").addClass("activeFilter").addClass(a.type),c=$("<span>").text(a.key).addClass("key"),d=$("<span>").text("X").addClass("close");return b.append(c).append(d),b.on("click",function(){r(a)}),b},m=function(a){var b=a.type+"_"+a.key;return b=b.replace(/[ !@#$%\^&\*\(\)\/,./<>?;:\\[\]\{\}\|_+-=]/g,"_")};this.isRouteInFilter=function(a){var b,c,e,f=!1,g=!1;for(c=0;c<d.length;c++)if(b=d[c],"Travels"==b.type&&(g=!0,a.Tvs==b.key)){f=!0;break}g||(f=!0);for(var h=!1,i=!1,j=[],k=0;k<d.length;k++){var l=d[k];"BusType"==l.type&&j.push(l)}var m=!1;if(3!==j.length)if(2===j.length){if(!("AC"==j[0].key&&"Non AC"==j[1].key||"Non AC"==j[0].key&&"AC"==j[1].key))for(c=0;c<d.length;c++)if(b=d[c],"BusType"==b.type){if(i=!0,!(a.IsAc&&"AC"==b.key||a.IsNAc&&"Non AC"==b.key||a.IsSlpr&&"Sleeper"==b.key)){m=!1;break}m=!0}}else for(c=0;c<d.length;c++)if(b=d[c],"BusType"==b.type){if(i=!0,!(a.IsAc&&"AC"==b.key||a.IsNAc&&"Non AC"==b.key||a.IsSlpr&&"Sleeper"==b.key)){m=!1;break}m=!0}i||(h=!0),i&&m&&(h=!0);var n=!0,o=!1;for(c=0;c<d.length;c++)if(b=d[c],"Amenities"==b.type){o=!0;var p=!1;for(e=0;e<a.Ament.length;e++)if(amenitiesJSON[a.Ament[e]-1].Name==b.key){p=!0;break}n=n&&p}o||(n=!0);var q=!1,r=!1;for(c=0;c<d.length;c++)if(b=d[c],"BP"==b.type){for(r=!0,e=0;e<a.BPLst.length;e++)if(a.BPLst[e]&&a.BPLst[e].Loc.trim()==b.key.trim()){q=!0;break}if(q)break}r||(q=!0);var s=!1,t=!1;for(c=0;c<d.length;c++)if(b=d[c],"DP"==b.type){for(t=!0,e=0;e<a.DPLst.length;e++)if(a.DPLst[e]&&a.DPLst[e].Loc.trim()==b.key.trim()){s=!0;break}if(s)break}t||(s=!0);var u=!1,v=!1;for(c=0;c<d.length;c++)if(b=d[c],"Rating"==b.type&&(v=!0,"All Buses"==b.key||"Higher Rated"==b.key&&a.isHighRated)){u=!0;break}v||(u=!0);var w=f&&h&&n&&q&&s&&u;return w};var n=function(a){a.stopPropagation();var b=$(a.currentTarget),c=b.parent(),d=c.attr("class").split(" ")[1],e=c.hasClass("opened");o(d,e),g.find(".filter").not(c).removeClass("opened"),c.toggleClass("opened"),c.hasClass("opened")&&($(".display-none").removeClass("display-none"),$(".load-more-buses").addClass("display-none")),$(".about-source").removeClass("display-none"),$(".about-destination").addClass("display-none"),$(".route-switch .src-tab").addClass("active").removeClass("inactive"),$(".route-switch .dst-tab").addClass("inactive").removeClass("active")},o=function(a,b){var c;b?(c=a+"_close",RBxt_click(this,"C","2",c,"A")):(c=a+"_open",RBxt_click(this,"C","2",c,"A"))},p=function(a){return function(b){var d=b.currentTarget,e=$(d).is(":checked");e?c.addFilter(a):r(a)}};this.addFilter=function(a){for(var b=0;b<d.length;b++)if(d[b].type==a.type&&d[b].key==a.key)return;if("Rating"==a.type)for(b=0;b<d.length;b++)d[b].type==a.type&&(u(d[b],!1),d.splice(b,1));d.push(a),u(a,!0)},this.pushFilters=function(a){for(var b=0;b<d.length;b++)if(d[b].type==a.type&&d[b].key==a.key)return;if("Rating"==a.type)for(b=0;b<d.length;b++)d[b].type==a.type&&(u(d[b],!1),d.splice(b,1));d.push(a),q(a,!0)};var q=function(a,b){var c=m(a);$("#"+c).attr("checked",b),v(),k()},r=function(a){for(var b=0;b<d.length;b++)if(d[b].type==a.type&&d[b].key==a.key)return d.splice(b,1),void u(a,!1)};this.resetFilters=function(){d=[],t()};var s=function(a){for(var b=0;b<d.length;b++)d[b].type==a&&(u(d[b],!1),d.splice(b,1),b--);t()},t=function(){g.find('.filter ul li input[type="checkbox"]').attr("checked",!1),v(),k()},u=function(a,b){var c=m(a);$("#"+c).attr("checked",b),v(),k()},v=function(){RB.Preferences.set("LAST_USED_FILTERS",JSON.stringify(d))};h()},Buses1=function(){var a=this,b={};this.amenitiesData=[];var c,d=1,e=!1,f="/Booking/SearchResultsJSON.aspx";this.sortOptions={by:"_Rating",order:-1},this.cancelFetch=function(){c.abort()};var g=function(a,b){var c=0;return"SOLDOUT"==a.BsSt&&"SOLDOUT"!=b.BsSt?c=1:"SOLDOUT"!=a.BsSt&&"SOLDOUT"==b.BsSt&&(c=-1),c},h=function(a){return a&&a.totRt?a.totRt:0},i={defaultComp:function(b,c){var d=g(b,c);return 0!==d?d:(b[a.sortOptions.by]>c[a.sortOptions.by]?d=1:b[a.sortOptions.by]<c[a.sortOptions.by]&&(d=-1),a.sortOptions.order*d)},_Duration:function(b,c){var d=g(b,c);if(0!==d)return d;var e=Date.getTimeDifferenceInMins(b.DpTm,b.ArTm),f=Date.getTimeDifferenceInMins(c.DpTm,c.ArTm);return d=e-f,a.sortOptions.order*(d/Math.abs(d))},_Rating:function(b,c){var d=g(b,c);if(0!==d)return d;var e=h(b.Rtg),f=h(c.Rtg);return d=e-f,a.sortOptions.order*(d/Math.abs(d))},_Fare:function(b,c){var d=g(b,c);if(0!==d)return d;var e=a.getMinFare(b.FrLst),f=a.getMinFare(c.FrLst);return d=e-f,a.sortOptions.order*(d/Math.abs(d))}};this.getMinFare=function(a){for(var b=a[0],c=1,d=a.length;d>c;c++)a[c]<b&&(b=a[c]);return b},this.getMinFareOfAllRoutes=function(){for(var a=1e4,b=this.modelData,c=0,d=b.length;d>c;c++){var e=b[c];if("SOLDOUT"!==e.BsSt)for(var f=0,g=e.FrLst.length;g>f;f++)a>e.FrLst[f]&&(a=e.FrLst[f])}return a},this.getOperatorNameById=function(a){for(var b=this.modelData,c=0;c<b.length;c++){var d=b[c];if(d.OpId==a)return d.Tvs}return null};var j=function(){a.sortOptions.order*=-1};this.setSortBy=function(a){this.sortOptions.by!=a?this.sortOptions.by=a:j(),this.sort()},this.fetch=function(a,b,g,h,i,j){var l={fromCityId:a,toCityId:b,doj:g.toRBString(),isSEO:1,opId:j};d=h,e=i;var m="Searching "+$(".route-title-h1").text();if("01-Jan-1970"!=g.toRBString()){var n=RB.URL.create(f,l);1!==d||e||(this.progress=new RB.Progress("loadingbar1",{steps:1,lastPostion:75,position:"relative",height:"32px",backgroundColor:"#00aef0"}),this.progress.start(50),$(".loadingText").html(m)),c=$.get(n,k)}};var k=function(b){if(200==b.status){var c=void 0===b.data?[]:b.data,f=b.RTCdata;if(void 0!==f){var g=f.length;if(g>0)for(var h=0;g>h;h++)c.push(f[h])}for(var i=0;i<c.length;i++){var j=c[i];j.ArTm=Date.toDateFromJson(j.ArTm),j.DpTm=Date.toDateFromJson(j.DpTm),j.isHighRated=l(j)}a.modelData=c,a.sort();var k=a.getMinFareOfAllRoutes();$("#minFareSpan").html(k),1!==d||e?(a.trigger("load",a.modelData),$(".routes-container").slideDown(),$(".showContainer").removeClass("Hide")):(a.progress.done(),setTimeout(function(){a.trigger("load",a.modelData),$(".routes-container").slideDown(),$(".showContainer").removeClass("Hide"),$(".loadingText").html(""),$("#loadingbar").css("margin-top","0")},1500))}else{a.modelData=[];var m={status:b.status,hadSales:b.hadSales||!1};1!==d||e?(a.trigger("error",m),$(".routes-container").slideDown(),$(".showContainer").removeClass("Hide")):(a.progress.done(),setTimeout(function(){a.trigger("error",m),$(".routes-container").slideDown(),$(".showContainer").removeClass("Hide"),$(".loadingText").html(""),$("#loadingbar").css("margin-top","0")},1500))}},l=function(a){var b=0,c=0,d=.1;a.Rtg.totRt&&(b=parseFloat(a.Rtg.totRt)),a.Rtg.Rt&&(c=a.Rtg.Rt.Bq);var e=b>2.75||c>4||d>2.75||0===d;return e};this.sort=function(){a.modelData.sort(m()),a.trigger("sort")};var m=function(){var b=i.defaultComp;return 0===a.sortOptions.by.indexOf("_")&&(b=i[a.sortOptions.by]),b};this.on=function(a,c){b[a]=c},this.trigger=function(a,c){b[a]&&b[a](c)}},SeatLayoutTemplatePromise=$.get("http://www.redbus.in/modules/SeatLayout/SeatLayout.html"),BusListItemtemplate=$("#BusTileTemplate").html();"2"===RB.URL.getQueryParam("ver")&&(BusListItemtemplate=$("#BusTileTemplateNew").html());var parsedBusListItemtemplate=$("<li>").html(BusListItemtemplate),bpTooltipTemplate=$("<div>").html($("#bpTooltipTemplate").html()),dpTooltipTemplate=$("<div>").html($("#dpTooltipTemplate").html()),bpdpTooltipItemTemplate=$("<li>").html($("#bpdpTooltipItemTemplate").html()),superfastTrackTemplate=$("<div>").html($("#superfastTrackTemplate").html()),BusItemView1=function(a,b,c,d,e,f){var g;this.render=function(){g=parsedBusListItemtemplate.clone(),g.find(".busItem").attr("data-routeid",a.RtId),"cab"==a.vt?a.Ament.indexOf(19)>=0?(g.find(".busIcon").addClass("icon-taxi_tracking"),g.find(".timeImgBlock").addClass("icon-superfast")):(g.find(".busIcon").addClass("icon-taxi"),g.find(".timeImgBlock").addClass("icon-superfast")):a.Ament.indexOf(19)>=0?(g.find(".busIcon").addClass("icon-bus_tracking").attr("href","/track-my-bus.aspx"),g.find(".timeImgBlock").addClass("icon-time")):(g.find(".busIcon").addClass("icon-bus"),g.find(".timeImgBlock").addClass("icon-time")),g.find(".BusName").text(a.Tvs),g.find(".BusName").attr("title",a.Tvs),g.find(".BusType").text(a.BsTp),g.find(".BusType").attr("title",a.BsTp),a.Glry||(g.find(".PhotosLink").hide(),g.find(".VideoLink").hide()),a.Tips<=0&&g.find(".TipsLink").hide(),a.Glry||g.find(".busTypeLinks").hide();var b=a.ArTm,c=a.DpTm,d="--",e="--";g.find(".DepartureTime").text(c.toRBTimeString()),8065===a.OpId?(g.find(".ArrivalTime").text(d),g.find(".Duration").text(e)):(g.find(".ArrivalTime").text(b.toRBTimeString()),g.find(".Duration").text(Date.getTimeDifferenceString(c,b))),"AVAILABLE"==a.BsSt?(g.find(".AvailableSeats").text(a.NSA),g.find(".AvailableWindowSeats").text(a.WnSt)):"SOLDOUT"==a.BsSt&&(g.find(".seatsAv").text("-"),g.find(".seatsWinAv").hide(),g.find(".viewSeatsBtn").attr("disabled","disabled").text("Sold Out")),a.IsMTE?g.find(".Mticket").attr("href","/mTicket.aspx?opId="+a.OpId):g.find(".Mticket").addClass("nomTicket").text("-");for(var f=[],h=0;h<a.FrLst.length;h++)f.push(k(a.Cmpg,a.FrLst[h]));return g.find(".Fare").text(f.join("http://www.redbus.in/")),a.Cmpg&&1==a.Cmpg.Vld&&i(),m(a.Ament),l(),g},this.getLastRendered=function(){return g},this.isRendered=function(){return g?!0:!1},this.bindEvents=function(){if(g.find(".CancellationPolicyLink").off("click"),g.find(".AddressLink").off("click"),g.find(".PhotosLink").off("click"),g.find(".VideoLink").off("click"),g.find(".TipsLink").off("click"),g.find(".viewSeatsBtn").off("click"),g.find(".CancellationPolicyLink").on("click",s),g.find(".AddressLink").on("click",t),g.find(".PhotosLink").on("click",u),g.find(".VideoLink").on("click",v),g.find(".TipsLink").on("click",w),g.find(".viewSeatsBtn").on("click",x),A(),1==a.Cmpg.Vld&&(null!==a.Cmpg.RT&&j(g.find(".OperatorCampaigns .RT .knowMore"),a.Cmpg.RT),null!==a.Cmpg.noRT&&"DEFAULT"==a.Cmpg.noRT.spcl&&j(g.find(".OperatorCampaigns .noRT .knowMore"),a.Cmpg.noRT)),a.IsSpF&&(g.find(".SpecialBus").text("High Fare"),new RB.Tooltip(g.find(".SpecialBus"),$("#HighFareTooltipTemplate").html(),{offset:{X:-160,Y:30}})),4402051==a.RtId&&(g.find(".SpecialBus").text("Go Green"),new RB.Tooltip(g.find(".SpecialBus"),$("#GoGreenTooltipTemplate").html(),{offset:{X:-160,Y:30}})),3338==a.OpId&&4302271!=a.RtId&&(g.find(".SpecialBus").text("business class"),new RB.Tooltip(g.find(".SpecialBus"),$("#BusinessClassTooltipTemplate").html(),{offset:{X:-160,Y:30}})),a.IsMTE&&new RB.Tooltip(g.find(".Mticket"),$("#mTicketTooltipTemplate").html()),amenitiesJSON.length>0){$amn=g.find(".BusAmenities");var b=a.Ament;if(0!==b.length){var c,d,e=$amn.find("[data-amenityId]"),f=b.slice(0);for(d=0,amntIcoLength=e.length;d<amntIcoLength;d++){var h=$(e[d]),i=Number(h.attr("data-amenityId"));c=amenitiesJSON[i-1],c&&(b.indexOf(i)>=0?n(h,c.DisplayName,c.Description):n(h,c.DisplayName,"Unavailable")),i>0&&f.indexOf(i)>=0&&f.splice(f.indexOf(i),1)}f.indexOf(14)>=0&&f.splice(f.indexOf(14),1);var k="Other amenities";if(f.length>0){var l=$("<div>").html("This bus also provides"),m=$("<ul>").addClass("addAmenities"),q=0;for(d=0,amntLstLength=f.length;d<amntLstLength;d++)c=amenitiesJSON[f[d]-1],c&&14!=c.Id&&(m.append($("<li>").text(c.DisplayName)),q++);l.append(m),n($amn.find('[data-amenityId="-1"]'),k,l.html())}else n($amn.find('[data-amenityId="-1"]'),k,"Unavailable")}}a.Rtg&&a.Rtg.totRt&&g.find(".ratingsBlock .ratingsText").on("click",w).css("cursor","pointer"),o(),p()};var h=function(a){var b=$(event.target).parents(".busItem"),c=b.find(".BusName").text(),d=b.data("routeid"),e=routePosition[d]+a+"-"+c+"-"+d;RBxt_click(this,"C","2",e,"A")},i=function(){var b=g.find(".OperatorCampaigns"),c=!0;null!==a.Cmpg.RT&&("EXCLUSIVE"===a.Cmpg.RT.cmpgType&&b.find(".icon-opOffer").addClass("icon-exclusive").removeClass("icon-opOffer"),b.find(".RT .title").addClass("bpdp"),b.find(".RT .content").addClass("bpdp").text(a.Cmpg.RT.cmpgDesc),a.Cmpg.RT.cmpgNote&&b.find(".RT").show(),c=!0),null!==a.Cmpg.noRT&&"DEFAULT"==a.Cmpg.noRT.spcl&&("EXCLUSIVE"===a.Cmpg.noRT.cmpgType&&b.find(".icon-opOffer").addClass("icon-exclusive").removeClass("icon-opOffer"),b.find(".RT .title").addClass("bpdp"),b.find(".noRT .content").addClass("bpdp").text(a.Cmpg.noRT.cmpgDesc),a.Cmpg.noRT.cmpgNote&&b.find(".noRT").show(),c=!0),null!==a.Cmpg.RT&&null!==a.Cmpg.noRT&&"DEFAULT"==a.Cmpg.noRT.spcl&&b.find(".seperator").show(),c&&b.show()},j=function(a,b){var c=$("<div>");c.html($("#OperatorCampaignTooltipTemplate").html()),c.find(".title").addClass("bpdp"),
c.find(".content").addClass("cmpg-desc").html(b.cmpgNote.join("<br/>")),new RB.Tooltip(a,c.html(),{offset:{X:0,Y:20}})},k=function(a,b){var c=b,d=0,e="FLAT";return a&&1==a.Vld&&null!==a.noRT&&"REDUCEDFARE"==a.noRT.spcl&&(d=parseFloat(a.noRT.discUnit),e=a.noRT.cmpgType),"PERCENT"==e?c=Math.round(b-b*d/100):"FLAT"==e&&(c=Math.round(b-d)),c},l=function(){a.Rtg?a.Rtg.totRt?(g.find(".ratingsBlock .Rating").css("width",a.Rtg.totRt/5*100+"%"),g.find(".ratingsBlock .ratingStars").attr("title",a.Rtg.totRt+"/5"),g.find(".ratingsBlock .numRating").text(a.Rtg.Rt.Ct),a.isHighRated||(g.find(".ratingsBlock .Rating").removeClass("icon-icon_ratingFilled").addClass("icon-icon_ratingFilledRed"),g.find(".ratingsBlock .numRating").addClass("lowRating"))):"NR"==a.Rtg.Rev&&(g.find(".ratingsBlock .ratingsText").text("No Ratings"),g.find(".ratingsBlock").addClass("Hidden")):(g.find(".ratingsBlock .ratingsText").text("No Ratings"),g.find(".ratingsBlock").addClass("Hidden"))},m=function(a){if($amn=g.find(".BusAmenities"),0===a.length||0===amenitiesJSON.length)$amn.html("&nbsp;");else{var b,c=$amn.find("[data-amenityId]"),d=a.slice(0);for(b=0,amntIcoLength=c.length;b<amntIcoLength;b++){var e=$(c[b]),f=Number(e.attr("data-amenityId"));a.indexOf(f)>=0&&e.attr("class",e.attr("class")+"_enabled"),f>0&&d.indexOf(f)>=0&&d.splice(d.indexOf(f),1)}d.indexOf(14)>=0&&d.splice(d.indexOf(14),1);if(d.length>0){var h=$amn.find('[data-amenityId="-1"]').attr("class");$amn.find('[data-amenityId="-1"]').attr("class",h+"_enabled")}}},n=function(a,b,c){var d=$("<div>").html($("#genericTooltipTemplate").html());d.find(".title").text(b),d.find(".content").html(c);new RB.Tooltip(a,d.html(),{offset:{X:0,Y:30}})},o=function(){new RB.Tooltip(g.find(".DepartureTime"),q(a.BPLst,"BP"));if(8065!==a.OpId){new RB.Tooltip(g.find(".ArrivalTime"),q(a.DPLst,"DP"))}},p=function(){var b="This vehicle covers the distance in much less duration as compared to others",c="These are cab services that offer point-to-point services and convenient pick-up points closer to home or work",d="These are point-to-point cab services that offer comfortable boarding/dropping points and are fitted with a GPS device that helps you locate your cab any time";"cab"==a.vt&&(a.Ament.indexOf(19)>=0?(new RB.Tooltip(g.find(".icon-superfast"),r(b)),new RB.Tooltip(g.find(".busIcon"),r(d))):(new RB.Tooltip(g.find(".icon-superfast"),r(b)),new RB.Tooltip(g.find(".busIcon"),r(c))))},q=function(a,b){var c;c="BP"==b?bpTooltipTemplate.clone():dpTooltipTemplate.clone();for(var e=c,f=e.find(".content"),g=0,h=a.length;h>g;g++){var i=a[g],j=bpdpTooltipItemTemplate.clone(),k=i.Tm,l=new Date(d).addMins(k);j.find(".BPDPName").text(i.Loc),j.find(".BPDPTime").text(l.toRBTimeString()),f.append(j)}return e.html()},r=function(a){var b=superfastTrackTemplate.clone();return b.find(".track-superfast").html(a),b.html()},s=function(){var b="/routemoreinfo.aspx",c={r:a.RtId,d:d.toRBString()},e=RB.URL.create(b,c),f=new RB.Modal(e,{width:680,height:450,showURL:!0});f.show(),h("cancel-link")},t=function(){s(),h("address")},u=function(){var b=a.BsTp.replace(/\+/g,"_"),c="/SlideShow.aspx",e={busType:b,type:"Photos",od:a.OpId,bt:a.BsSvId,r:a.RtId,d:d.toRBString()},f=RB.URL.create(c,e),g=new RB.Modal(f,{width:705,height:450,showURL:!0});g.show(),h("photos")},v=function(){var b=a.BsTp.replace(/\+/g,"_"),c="/SlideShow.aspx",e={busType:b,type:"Video",od:a.OpId,bt:a.BsSvId,r:a.RtId,d:d.toRBString()},f=RB.URL.create(c,e),g=new RB.Modal(f,{width:705,height:450,showURL:!0});g.show(),h("videos")},w=function(){var b=$($(".From")[0]).text(),c=$($(".To")[0]).text(),e=$(this).parents(".busItem"),f=e.find(".BusName").text(),g=e.find(".DepartureTime").text(),h=e.find(".ArrivalTime").text(),i=(e.find(".BusAmenities").text(),e.find(".ratingStars").attr("title")),j=e.find(".ratingsText span").text(),k="/RatingAndReviews/RatingAndReviewNew.aspx",l={r:a.RtId,d:d.toRBString(),from:b,to:c,travels:f,arr:h,dep:g,ratingtitle:i,ratingNum:j},m=RB.URL.create(k,l),n=new RB.Modal(m,{width:960,height:490,showURL:!0});n.show()},x=function(){g.find(".seatlayoutDropDown").hasClass("opened")?(A(),h("HideSeat")):y()},y=function(){var b="/Booking/SeatSelectionJSON.aspx",c=sourceId,e=destinationId;$onwardTab.hasClass("inactive")&&(c=destinationId,e=sourceId);var f={rt:a.RtId,sourceId:c,destinationId:e,doj:d.toRBString()},h=RB.URL.create(b,f),i=$.get(h);i.done(z),i.fail(B),g.find(".viewSeatsBtn").attr("disabled","disabled").addClass("loadingSeats")},z=function(b){SeatLayoutTemplatePromise.done(function(c){if(null!==b&&"null"!==b){g.find(".viewSeatsBtn").removeAttr("disabled").removeClass("loadingSeats").text("Hide Seats");var d=g.find(".seatlayoutContainer"),e={showBPSelect:!0};2==f&&(e.minSeatsRequired=RB.SelectBus1.seatRequiredToBeSelected,e.maxSeatsAllowed=RB.SelectBus1.seatRequiredToBeSelected,e.isReturn=!0);{new SeatLayout(c,d,b,C,e)}!a.isHighRated&&a.Rtg.totRt>0&&D(),null!==b.Notes&&""!==b.Notes&&(g.find(".routeNote .content").text(b.Notes),g.find(".routeNote").show()),g.find(".seatlayoutDropDown .seatLayoutClose").on("click",A),g.find(".seatlayoutDropDown").addClass("opened").height(g.find(".seatLayoutMain").outerHeight(!0))}else B()})},A=function(){g.find(".seatlayoutDropDown").removeClass("opened").height(0),g.find(".viewSeatsBtn").is("[disabled]")||g.find(".viewSeatsBtn").text("View Seats")},B=function(){g.find(".viewSeatsBtn").removeAttr("disabled").removeClass("loadingSeats"),alert("Sorry, some error occured due to which we are unable to load seat layout.")},C=function(a){return RB.SelectBus1.onContinue(a),RBxt_click(this,"C","2","ContinueToCustInfo","A")},D=function(){var a=g.find(".seatLayoutBox .lowRatingMessage");E(a),a.show()},E=function(b){var c,d=a.Rtg.Rt,e=!1,f=!1,g=!1,h=0;d.Bq<2.75?(c=b.find(".busQuality"),c.find(".Rating").css("width",d.Bq/5*100+"%"),c.find(".ratingValue").text(d.Bq.toFixed(1)),b.find(".summary .bqLink").show(),c.show(),new RB.Tooltip(c.find(".ratingType"),'<div class="generic">signifies that the bus may not be clean or amenities like water are not provided</div>',{offset:{X:0,Y:20}}),e=!0,h++):(c=b.find(".busQuality"),c.find(".Rating").removeClass("icon-rating_star_red").addClass("icon-rating_star_yellow"),c.find(".ratingMessage").hide()),d.Pun<2.75?(c=b.find(".punctuality"),c.find(".Rating").css("width",d.Pun/5*100+"%"),c.find(".ratingValue").text(d.Pun.toFixed(1)),b.find(".summary .punLink").show(),c.show(),new RB.Tooltip(c.find(".ratingType"),'<div class="generic">signifies that the bus may not depart/arrive on the scheduled time</div>',{offset:{X:0,Y:20}}),f=!0,h++):(c=b.find(".punctuality"),c.find(".Rating").removeClass("icon-rating_star_red").addClass("icon-rating_star_yellow"),c.find(".ratingMessage").hide()),d.St<2.75?(c=b.find(".staffBehaviour"),c.find(".Rating").css("width",d.St/5*100+"%"),c.find(".ratingValue").text(d.St.toFixed(1)),b.find(".summary .stLink").show(),c.show(),new RB.Tooltip(c.find(".ratingType"),'<div class="generic">signifies that the staff may not be very well behaved / cooperative</div>',{offset:{X:0,Y:20}}),g=!0,h++):(c=b.find(".staffBehaviour"),c.find(".Rating").removeClass("icon-rating_star_red").addClass("icon-rating_star_yellow"),c.find(".ratingMessage").hide()),2==h&&((e||f)&&(b.find(".and1").show(),b.find(".and2").show()),g?b.find(".and1").hide():b.find(".and2").hide()),3==h&&(b.find(".and1").hide(),b.find(".and2").show(),b.find(".comma1").show(),b.find(".comma2").hide()),b.find(".summary .numRating").text(a.Rtg.Rt.Ct+" customer")}},SortTemplate=$("#SortTemplate").html(),routePosition=[],returnBusCount;"2"===RB.URL.getQueryParam("ver")&&(SortTemplate=$("#SortTemplateNew").html());var BusesView1=function(a,b,c,d,e,f,g,h,i){var j,k,l=null,m=this,n=!1;void 0!==i&&(n=i),this.initialize=function(){j=new Buses1,j.on("load",this.render),j.on("error",this.onError),j.fetch(b,c,d,f,n,g),q();var e=navigator.userAgent.toLowerCase();e=-1!=e.indexOf("msie")?parseInt(e.split("msie")[1],10):-1,a.append(-1===e?$("#loaderTemplate").html():9>=e?$("#IEloaderTemplate").html():$("#loaderTemplate").html()),k=0;var h=RB.URL.getQueryParam("routeid");null!==h&&$(".busItem[data-routeid="+h+"]").find(".viewSeatsBtn").click(),p()},this.changeDay=function(a){d=new Date(a),l=null,n=!0,m.initialize()},this.getMinFare=function(){return j.getMinFareOfAllRoutes()};var o,p=function(){$("#load-more-buses").on("click",function(){$(".display-none").removeClass("display-none"),$(".load-more-buses").addClass("display-none"),$(".about-source").removeClass("display-none"),$(".about-destination").addClass("display-none"),$(".route-switch .src-tab").addClass("active").removeClass("inactive"),$(".route-switch .dst-tab").addClass("inactive").removeClass("active")});var a=$(".route-switch .src-tab"),b=$(".route-switch .dst-tab"),c=$(".about-source"),d=$(".about-destination");a.on("click",function(){a.hasClass("inactive")&&(a.addClass("active").removeClass("inactive"),b.addClass("inactive").removeClass("active"),c.removeClass("display-none"),d.addClass("display-none"))}),b.on("click",function(){b.hasClass("inactive")&&b.addClass("active").removeClass("inactive"),a.addClass("inactive").removeClass("active"),d.removeClass("display-none"),c.addClass("display-none")}),$(".icon-rating-stars.ratingStars").css("width",avgRtPer+"%");for(var e=[],f=$("#journey-time").html().split(""),g=0,h=f.length;h>g&&"h"!=f[g];g++)e.push(f[g]);$("#journey-time").html(e.join(""))};this.render=function(){for(var a=0,b=0;b<j.modelData.length;b++)a+=j.modelData[b].NSA;RB.SelectBus1.setTotalSeatInTab(a,f),q(),o=new Filter(j.modelData,r);var c=$("#onwardSortAndFilter");if(2==f&&(c=$("#returnSortAndFilter")),c.append(o.render()),c.append(t()),r(),h.length>0)for(var d=0,e=h.length;e>d&&"Any"!=h[0];d++){var i;if("1"==h[d]?i="AC":"2"==h[d]?i="Non AC":"3"==h[d]&&(i="Sleeper"),void 0!==i){var k={type:"BusType",key:i};o.pushFilters(k)}}if(null!==g&&0!==g){var l=j.getOperatorNameById(g);null!==l&&o.addFilter({type:"Travels",key:l})}try{Pixel.Config.isIbiboRetargeting&&Pixel.SelectBus.IbiboRetargeting&&1==f&&Pixel.SelectBus.IbiboRetargeting.onRoutesLoad(f)}catch(m){}},this.onError=function(e){a.children().remove(),e.hadSales?v():a.append($("#ErrorTemplate").html()),function(){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"==document.location.protocol?"https://":"http://")+"stats.g.doubleclick.net/dc.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}(),"01-Jan-1970"!==d.toRBString()&&(_gaq.push(["_setAccount","UA-1525387-1"]),_gaq.push(["_trackEvent","Oops-type",e.message,cities[b]+"-"+cities[c],d.getDDMMYYYY()]))};var q=function(){var b=$("#onwardSortAndFilter");2==f&&(b=$("#returnSortAndFilter")),b.children().remove(),a.children().remove()},r=function(){u(),a.find(".BusList").remove();var b=s();a.append(b),setTimeout(function(){for(var a=j.modelData,b=0;b<a.length;b++)route=a[b],o.isRouteInFilter(route)&&l[route.RtId]&&l[route.RtId].bindEvents()},1e3)},s=function(){var g,h,i,m,n=j.modelData,p=$("<ul>").addClass("BusList"),q=0,r=n.length;if(a.find(".noFilter").remove(),null===l){for(l={},i=0;r>i;i++)if(m=n[i],2!=f||2020!=m.OpId&&3030!=m.OpId&&4040!=m.OpId&&8065!=m.OpId){var s=new BusItemView1(m,b,c,d,e,f);if(s.render(),l[m.RtId]=s,routePosition.length!==m.length){var t=String(n[i].RtId);routePosition[t]=i}}Object.keys?g=Object.keys(l).length:Object.keys=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);g=b.length},returnBusCount=g;var u=$(".tab.onward"),v=$(".tab.return");u.hasClass("inactive")&&v.hasClass("active")&&4>g&&$(".load-more-buses").addClass("display-none"),u.hasClass("active")&&v.hasClass("Hide")&&g>4&&$("#buses-count").html(g-4),u.hasClass("active")&&v.hasClass("inactive")||!(g>4)||$("#buses-count").html(g-4)}var w=[];for(i=0;r>i;i++)if(m=n[i],(2!=f||2020!=m.OpId&&3030!=m.OpId&&4040!=m.OpId&&8065!=m.OpId)&&o.isRouteInFilter(m)&&l[m.RtId]&&(h=l[m.RtId].getLastRendered(),4>=g&&h.find(".display-none").removeClass("display-none"),h.find(".display-none").removeClass("display-none"),p.append(h),q++,"undefined"!=typeof opID&&null!==opID&&0!==opID&&"0"!==opID)){var x=j.getMinFare(m.FrLst);w.push(x)}if("undefined"!=typeof opID&&null!==opID&&0!==opID&&"0"!==opID){var y=j.getMinFare(w);$("#minFareSpan").html(y)}if(0===q){var z=$("<div>").html($("#ErrorFilterTemplate").html()).addClass("noFilter");z.find(".resetFilters").on("click",function(){o.resetFilters()}),a.append(z)}return k++,p},t=function(){var a=SortTemplate,b=$("<div>").html($("<div>").html(a).addClass("SortBar").addClass("clearfix").addClass("MB")).addClass("SortBarDiv");return b.find("a").on("click",function(a){var b=$(a.currentTarget).attr("data-sortBy");j.setSortBy(b),r()}),b},u=function(){var a=$("#onwardSortAndFilter");2==f&&(a=$("#returnSortAndFilter"));var b=j.sortOptions.by,c=a.find('.SortBar a[data-sortBy="'+b+'"]');a.find(".SortBar a").removeClass("asc").removeClass("desc"),c.addClass(-1==j.sortOptions.order?"desc":"asc")};this.showHighRatedBuses=function(){o.addFilter({type:"Rating",key:"Higher Rated"})},this.getNumberOfHighRatedSeats=function(){for(var a=j.modelData,b=0,c=0,d=a.length;d>c;c++){var e=a[c];e.isHighRated&&(b+=e.NSA)}return b};var v=function(){var b=$("<div>").html($("#RemindMeTemplate").html());b.find(".submitRemindMe").on("click",w),a.append(b)},w=function(){var e=a.find(".remindMe"),f=new RB.Validator(e),g=f.validate();if(g){var h="/Booking/RemindMe.aspx",i={name:e.find(".rmName").val(),mobile:e.find(".rmMobile").val(),email:e.find(".rmEmail").val(),fromcityid:b,fromcityname:cities[b],tocityid:c,tocityname:cities[c],doj:d.toRBString()},j=RB.URL.create(h,i);a.find(".remindMe .submitRemindMe").attr("disabled","disabled").addClass("loading");var k=$.get(j);k.done(x),k.fail(y)}},x=function(b){$form=a.find(".remindMe");var c=$form.find(".rmName").val();b.d?z("Thanks "+c+", we will send you an alert once the bookings open for this date.",!1):z("Sorry "+c+", Due to some technical glitch we are unable to process your request. Please try again.",!0),a.find(".remindMe .submitRemindMe").removeAttr("disabled").removeClass("loading")},y=function(){$form=a.find(".remindMe");var b=$form.find(".rmName").val();a.find(".remindMe .submitRemindMe").removeAttr("disabled").removeClass("loading"),z("Sorry "+b+", Due to some technical glitch we are unable to process your request. Please try again.",!0)},z=function(b,c){a.find(".remindMeMessage").text(b),c?a.find(".remindMeMessage").addClass("error"):(a.find(".remindMe").hide(),a.find(".remindMeMessage").removeClass("error"))}},ModifySearch=function(a,b,c,d){{var e,f,g,h,i,j,k=$("#txtSource"),l=$("#txtDestination"),m=$("#txtOnwardCalendar"),n=$("#txtReturnCalendar");new RB.Validator($("#Search"))}this.initialize=function(){e=new RB.AutoFill(k,{dataSource:cities,onSelect:function(a){l.focus().select(),RB.Master.customerCareView.selectCity(a.split("_")[0])}}),f=new RB.AutoFill(l,{dataSource:cities,onSelect:function(){l.is(":focus")&&""===m.val()&&m.focus()},filter:function(a){return a==e.selectedId?!1:0===a.indexOf(e.selectedId+"_")?!1:!0}}),g=new RB.Calendar(n,{now:serverDate},function(){s()}),h=new RB.Calendar(m,{now:serverDate},function(a){s(),g.setStartDate(a)}),e.set(a),f.set(b),h.setDate(c),g.setStartDate(c),"01-Jan-1970"!==d.toRBString()?g.setDate(d):(n.parent().hide(),q(c));var i=$("#mod_search .modifyLink"),p=Date.getFromRBDate(todayDate),r={months:[0,1],startDate:p,selectedDate:c,calenderPosition:"left",title:"Modify date"};j=new RB.Calendar(i,r,o)};var o=function(a){var b=e.selectedId,c=f.selectedId;if(onwardSelectDate=a,s())p(b,c,onwardSelectDate,returnSelectDate);else{var d='<div class="overlayTxt">Onward date should be before return date</div>',g=new RB.Modal(d,{width:464,height:52});g.show()}};this.hideModifySearchLink=function(){$("#modifySearch .modifyLink").hide()},this.update=function(e,f,j,k){a=e,b=f,c=j,d=k,h.setDate(c),h.setStartDate(new Date),g.setStartDate(c),"01-Jan-1970"!==d.toRBString()?g.setDate(d):(i.setDate(c),i.setStartDate(c))};var p=function(a,b,c,d){var e={fromCityId:a,toCityId:b,doj:c.toRBString(),busType:"Any",opId:0};"01-Jan-1970"!==d.toRBString&&(e.doj1=d.toRBString()),$("#mod_search .modifyLink").hasClass("clicked")&&($("#mod_search .modifyLink").toggleClass("clicked"),$("#mod_search .modifyLink").addClass("active"),$(".TabBar").removeClass("RP17"),$(".sort-bar").removeClass("RP17"),$(".search-container").toggleClass("RP17")),onwardBusListView=new BusesView1($("#onwardTrip"),a,b,c,!0,1,opId,"Any",!0),onwardBusListView.initialize(),$("#dateDoubleOnward").html(e.doj),$(".From").html(cities[a]),$(".To").html(cities[b]),RB.SelectBus1.refreshPrevNextDay(a,b,c,d)},q=function(){var a=$("#retAddTrip"),b={months:[0,1],startDate:onwardSelectDate,calenderPosition:"right",title:"Select return date"};i=new RB.Calendar(a,b,r)},r=function(c){returnSelectDate=c,"01-Jan-1970"!==c.toRBString()&&($onwardTab.removeClass("W100Imp"),$onwardTab.addClass("onwardtab"),$("#ModifyLinkDiv").removeClass("W30").addClass("W50"),$("#OnwardDataDiv").removeClass("W40").addClass("W50"),$("#OnwardDataDiv").removeClass("LB").addClass("RB"),$("#addRetTripDiv").hide());var d=$("#returnTrip");RB.SelectBus1.returnBusListView=new BusesView1(d,b,a,c,!0,2,opId,"Any",!0),RB.SelectBus1.returnBusListView.initialize(),$returnTab.find(".From").html(cities[_to]),$returnTab.find(".To").html(cities[_from]),$returnTab.find("#dateDoubleReturn").html(c.toRBString()),RB.SelectBus1.returnDayDisplay(),$returnTab.css("display","block"),$returnTab.removeClass("Hide"),$("#dateDoubleOnward").html()===$("#dateDoubleReturn").html()&&$(".tab.onward .next").addClass("inactive"),RBxt_click(this,"C","2","ReturnTrip","A")},s=function(){return"01-Jan-1970"===returnSelectDate.toRBString()?!0:onwardSelectDate>returnSelectDate?!1:!0}};RB=RB||{},RB.SelectBus1=new function(){var a,b,c,d=$("#onwardTrip"),e=$("#returnTrip");$onwardTab=$(".TabBar .tab.onward"),$returnTab=$(".TabBar .tab.return");var f,g,h,i,j,k=$("#dateDay"),l=!1,m=1,n=[{},{}];this.seatRequiredToBeSelected=-1,_this=this;var o=function(){_from=sourceId,_to=destinationId,g=_from.split("_")[0],h=_to.split("_")[0],i="Any","Any"===i&&(i=[]);var k=$("#ctl00_ContentHolder_DOJ").val();l=!1,null===k&&(k=(new Date).toDateOnly());var m=window.location.hash;m?(m=m.slice(2),isValidDate(m)?b=new Date(m):"today"==m.toLowerCase()?b=serverDate:"tomorrow"==m.toLowerCase()?b=serverDate.addDays(1):(b=serverDate,window.location.hash="!today")):(window.location.hash="!today",b=serverDate),onwardSelectDate=b,l=!0,j="01-Jan-1970",c=Date.getFromRBDate(j),returnSelectDate=c,this.opId=opID?opID:"0",a=new BusesView1(d,g,h,b,l,1,opId,i),a.initialize(),"01-Jan-1970"!==j&&($onwardTab.removeClass("W100Imp"),$onwardTab.addClass("onwardtab"),$("#ModifyLinkDiv").removeClass("W30").addClass("W50"),$("#OnwardDataDiv").removeClass("W40").addClass("W50"),$("#OnwardDataDiv").removeClass("LB").addClass("RB"),$("#addRetTripDiv").hide(),_this.returnBusListView=new BusesView1(e,h,g,c,l,2,opId,i),_this.returnBusListView.initialize()),q(g,h,b,l),RB.Master.setHeader(cities[g]+" to "+cities[h]+" Buses"),f=new ModifySearch(g,h,b,c),f.initialize(),_this.initPrevNextDays(g,h,b,c),w(),p()},p=function(){var a=RB.URL.getQueryParam("routeId");$(".BusList").find("[data-routeid='"+a+"']").find(".viewSeatsBtn").click(),$(".answerContainer").find(".yes").length>0&&$(".answerContainer").find(".yes").click()},q=function(){$addTripTab=$(".TabBar .add"),$onwardTab.find(".From").text(cities[_from]),$onwardTab.find(".To").text(cities[_to]),"01-Jan-1970"!==j&&($addTripTab.hide(),$returnTab.find(".From").text(cities[h]),$returnTab.find(".To").text(cities[g]),$returnTab.show())};this.initPrevNextDays=function(){var a=$("#modifySearch"),b=$("#modifySearchReturn");a.find(".next").on("click",function(){return 1===m?($(".tab.onward .next").hasClass("inactive")||$("#dateDoubleOnward").html()===$("#dateDoubleReturn").html()||($(".load-more-buses").addClass("display-none"),window.scrollTo(0,174),v(1),r()),RBxt_click(this,"C","2","SearchNextDateBuses","A")):void 0}),a.find(".prev").on("click",function(){return 1===m?($(".tab.onward .prev").hasClass("inactive")||($(".load-more-buses").addClass("display-none"),window.scrollTo(0,174),v(-1),r()),RBxt_click(this,"C","2","SearchPreviousDateBuses","A")):void 0}),b.find(".next").on("click",function(){return 2===m?($(".tab.return .next").hasClass("inactive")||($(".load-more-buses").addClass("display-none"),window.scrollTo(0,174),v(1),_this.returnDayDisplay()),RBxt_click(this,"C","2","SearchNextDateBuses","A")):void 0}),b.find(".prev").on("click",function(){return 2===m?($(".tab.return .prev").hasClass("inactive")||($(".load-more-buses").addClass("display-none"),window.scrollTo(0,174),v(-1),_this.returnDayDisplay()),RBxt_click(this,"C","2","SearchPreviousDateBuses","A")):void 0}),_this.refreshPrevNextDay()};var r=function(){onwardSelectDate.equalsDate(new Date(todayDate))?(window.location.hash="!today",k.html("Today")):onwardSelectDate.equalsDate(new Date(todayDate).addDays(1))?(window.location.hash="!tomorrow",k.html("Tomorrow")):(window.location.hash="!"+onwardSelectDate.toRBString(),k.html(onwardSelectDate.toDayString()))};this.returnDayDisplay=function(){var a=$("#dateDayReturn");a.html(returnSelectDate.equalsDate(new Date(todayDate))?"Today":returnSelectDate.equalsDate(new Date(todayDate).addDays(1))?"Tomorrow":returnSelectDate.toDayString())},this.setTotalSeatInTab=function(a,b){var c=$(".TabBar .tab.onward");2==b&&(c=$(".TabBar .tab.return")),c.find(".TotalSeats").text(a),c.find(".seats").show()};var s=function(){RB.Master.setHeader(cities[h]+" to "+cities[g]+" Buses");var a=n[0],k=$onwardTab.find(".selectedData"),o=a.Seats.length,p=a.DOJ.toRBString(),q=o+" Seat",r="Hey, are you returning on the same day?",s="Book a return trip now?",u=$("<div>").html($("#ReturnJourneyPopUpTemplate").html()),w=u.find(".yes"),x=u.find(".no");o>1&&(q+="s"),$onwardTab.find(".selectedData.dateSelected").text(p),$onwardTab.find(".selectedData .seatsSelected").text(q);var y=$onwardTab.find(".onwardHoverData");y.find(".travels").text(a.Route.Name),y.find(".busType").text(a.Route.Type);for(var z=[],A=0,B=0;B<a.Seats.length;B++)z.push(a.Seats[B].Id),A+=a.Seats[B].Fare;y.find(".seatsCSV").text(z.join(", ")),y.find(".bpLoc").text(a.BP.bpLocation);var C=(new Date).toDateOnly();C.addMins(a.BP.bpTime),y.find(".bpTime").text(C.toRBTimeString()),y.find(".fare").text(A),k.show(),$onwardTab.find(".seats").hide();var D;"block"==$returnTab.css("display")&&(j=$("#dateDoubleReturn").html(),c=Date.getFromRBDate(j));var E=!1;if(l||b.equalsDate(c)){if(l&&b.equalsDate(c))$(".TabBar .tab.return .sameDayLabel").show(),u.find(".onwardDate").text(b.toRBString()),u.find(".question").text(r),w.text("Yes"),x.text("No"),w.on("click",function(){e.show(),$returnTab.show(),H.close()});else if("01-Jan-1970"===j)u.find(".question").text(s),w.text("Yes. I'd like to"),x.text("No. Not Now"),u.find(".onwardDate").html(""),D=x,x=w,w=D,w.on("click",function(){t()});else{E=!0;var F=$("<div>").html($("#tabSwitchTemplate").html());F.find(".from").text(cities[_from]),F.find(".to").text(cities[_to]),F.find(".onwardDate").text(onwardSelectDate.toRBString()),F.find(".returnDate").text(returnSelectDate.toRBString());var G=new RB.Modal(F,{width:550,height:300,isNonClosable:!0});G.show(),e.show(),$returnTab.show(),returnBusCount>4&&$("#load-more-buses").html(returnBusCount+" buses"),setTimeout(function(){G.hide()},3e3)}var H=new RB.Modal(u,{width:600,height:325,isNonClosable:!0});u.find(".fromCityName").text(cities[_from]),u.find(".toCityName").text(cities[_to]);{var I={months:[0,1],startDate:onwardSelectDate,title:"Select return date"};new RB.Calendar(x,I,function(a){returnSelectDate=a,_this.returnBusListView=new BusesView1(e,h,g,c,l,2,opId,i),_this.returnBusListView.initialize(),_this.returnBusListView.changeDay(a),c=new Date(a).toDateOnly(),c!==new Date(1970,1,1).toDateOnly()&&($onwardTab.removeClass("W100Imp"),$onwardTab.addClass("onwardtab"),$("#ModifyLinkDiv").removeClass("W30").addClass("W50"),$("#OnwardDataDiv").removeClass("W40").addClass("W50"),$("#OnwardDataDiv").removeClass("LB").addClass("RB"),$("#addRetTripDiv").hide(),$returnTab.find(".To").text(cities[_from]),$returnTab.find(".From").text(cities[_to]),e.show(),$returnTab.show(),_this.refreshPrevNextDay(),_this.returnDayDisplay()),$returnTab.find(".dateDisplay").text(returnSelectDate.toRBString()),v(0),H.close()})}E||H.show()}d.hide(),$("#onwardSortAndFilter").hide(),$("#returnSortAndFilter").show(),f.hideModifySearchLink(),m=2,$onwardTab.removeClass("active").addClass("inactive"),$onwardTab.find(".garrow").removeClass("active").addClass("inactive"),$onwardTab.find(".prev").removeClass("active").addClass("inactive"),$onwardTab.find(".next").removeClass("active").addClass("inactive"),$onwardTab.find(".modifyLink").removeClass("active").addClass("inactive"),$returnTab.removeClass("inactive").addClass("active"),$returnTab.find(".garrow").removeClass("inactive").addClass("active"),$returnTab.find(".prev").removeClass("inactive").addClass("active"),$returnTab.find(".next").removeClass("inactive").addClass("active"),_this.refreshPrevNextDay(),$(window).scrollTop(0)};this.onContinue=function(a){this.seatRequiredToBeSelected=a.Seats.length,1==m?n[0]=a:n[1]=a,2!=m&&l?s():t()};var t=function(){for(var a,b=httpsURL+"/Booking/CustInfo.aspx",d=n[0],e=[],f=d.Seats,g=0;g<f.length;g++)a=f[g].Id,e.push(a);var h={r:d.Route.Id,d:d.DOJ.toRBString(),s:e.join(","),b:d.BP.bpId};if(d.DP&&(h.dp=d.DP.bpId),"01-Jan-1970"!==c.toRBString()){var i=n[1];if(f=i.Seats,void 0!==f){for(e=[],g=0;g<f.length;g++)a=f[g].Id,e.push(a);h.rtd_r=i.Route.Id,h.rtd_d=i.DOJ.toRBString(),h.rtd_s=e.join(","),h.rtd_b=i.BP.bpId,i.DP&&(h.rtd_dp=i.DP.bpId)}}var j=RB.URL.create(b,h);location.href=j},u=function(){l=!1,t()};this.refreshPrevNextDay=function(){var a=$("#modifySearch"),b=$("#modifySearchReturn");2==m?(a.find(".skipReturnLeg").show(),a.find(".skipReturnLeg").on("click",u),b.find(".dateDisplay").text(returnSelectDate.toRBString())):("01-Jan-1970"!==j&&b.find(".dateDisplay").text(returnSelectDate.toRBString()),a.find(".dateDisplay").text(onwardSelectDate.toRBString()),r()),v(0)};var v=function(b){var d=$("#modifySearch"),e=$("#modifySearchReturn"),i=d,k=onwardSelectDate,n=a,o=(new Date).toDateOnly(),p=new Date(2030,1,1);1==m&&"01-Jan-1970"!==j?(p=returnSelectDate,i=d):1==m&&$(".TabBar .tab.return").hasClass("inactive")&&!$(".TabBar .tab.return").hasClass("Hide")?p=new Date($("#dateDoubleReturn").html()):c=2==m?returnSelectDate:Date.getFromRBDate(j),2==m&&(k=returnSelectDate,n=_this.returnBusListView,o=onwardSelectDate,i=e);var q=new Date(k).addDays(b);q>=o&&p>=q&&0!==b&&(k.addDays(b),n.changeDay(k),i.find(".dateDisplay").text(k.toRBString())),i.find(".prev").removeClass("inactive").addClass("active"),i.find(".next").addClass("inactive").addClass("active"),o>=k?i.find(".prev").addClass("inactive"):k>=p&&i.find(".prev").removeClass("inactive"),k>=p?i.find(".next").addClass("inactive"):i.find(".next").removeClass("inactive"),l&&onwardSelectDate.equalsDate(returnSelectDate)&&2==m?$(".TabBar .tab.return .sameDayLabel").show():$(".TabBar .tab.return .sameDayLabel").hide(),f.update(g,h,onwardSelectDate,returnSelectDate)};this.showHighRatedBuses=function(){1==m?a.showHighRatedBuses():_this.returnBusListView.showHighRatedBuses()},this.getNumberOfHighRatedSeats=function(){var b=0;return b=1==m?a.getNumberOfHighRatedSeats():_this.returnBusListView.getNumberOfHighRatedSeats()},this.getMinFare=function(b){var c=0;return 1==b?c=a.getMinFare():2==b&&(c=_this.returnBusListView.getMinFare()),c};var w=function(){var a=!1,b=!1,c=$(".fixer").offset().top;$(document).on("scroll",function(){b=$(document).scrollTop()>c,b&&!a&&($(".tripView").css("padding-top",$(".fixer").outerHeight(!0)),$(".fixer").addClass("fixed"),a=!0),!b&&a&&($(".tripView").css("padding-top",0),$(".fixer").removeClass("fixed"),a=!1)})};o()};
//# sourceMappingURL=routes-seo.min.js.map